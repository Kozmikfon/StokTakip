@model IEnumerable<StokTakip.Entities.Dtos.DepoTransferDetayDtos.DepoTransferDetayDto>

<table class="table table-bordered table-sm">
    <thead>
        <tr>
            <th>Malzeme</th>
            <th>Miktar</th>
            <th>Seri No</th>
            <th>Açıklama</th>
            <th class="text-end"></th>
        </tr>
    </thead>
    <tbody>
        @if (Model != null)
        {
            foreach (var d in Model)
            {
                <tr>
                    <td>@d.MalzemeAdi (@d.MalzemeId)</td>
                    <td>@d.Miktar</td>
                    <td>@d.SeriNo</td>
                    <td>@d.Aciklama</td>
                    <td class="text-end">
                        <button class="btn btn-sm btn-outline-danger"
                                onclick="removeLine(@d.Id, @d.TransferId)">
                            Sil
                        </button>
                    </td>
                </tr>
            }
        }
    </tbody>
</table>

<script>
    async function removeLine(detayId, transferId){
        if(!confirm('Satır silinsin mi?')) return;

        // token'ı sayfadaki formdan al
        const tokenInput = document.querySelector('input[name="__RequestVerificationToken"]');
        const token = tokenInput ? tokenInput.value : '';

        const res = await fetch('@Url.Action("RemoveLine", "DepoTransfer")?transferId=' + transferId + '&detayId=' + detayId, {
            method: 'POST',
            headers: { 'RequestVerificationToken': token }
        });

        if(res.ok){
            await window.refreshLines(transferId);
        } else {
            alert('Satır silinemedi.');
        }
    }
    window.removeLine = removeLine;
</script>
